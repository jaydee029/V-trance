http:
  routers:
    mainapi-router:
      rule: "PathPrefix(`/tranceapi`)"
      entryPoints: ["web"]
      service: tranceapi-service
      middlewares: 
        - auth-middleware
        - corsHeaders
    
    user-router:  #  router for /user
      rule: "PathPrefix(`/user`)"
      entryPoints: ["web"]
      service: user-service
      middlewares:
        - corsHeaders


  middlewares:
    auth-middleware:
      forwardAuth:
        address: "http://localhost:8081/user/verify"
        trustForwardHeader: true
        authResponseHeaders: ["X-User-ID"]
    
    corsHeaders:
      headers:
        accessControlAllowOriginList:
          - "http://localhost:3000"  # frontend origin
        accessControlAllowMethods:
          - "GET"
          - "POST"
          - "PUT"
          - "DELETE"
          - "OPTIONS"
        accessControlAllowHeaders:
          - "Authorization"
          - "Content-Type"
        accessControlAllowCredentials: true
        addVaryHeader: true


  services:
    tranceapi-service:
      loadBalancer:
        servers:
          - url: "http://localhost:8082/"
    
    user-service:  # actual user service
      loadBalancer:
        servers:
          - url: "http://localhost:8081/"
